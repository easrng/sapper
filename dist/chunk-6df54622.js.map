{"version":3,"file":"chunk-6df54622.js","sources":["../node_modules/.pnpm/port-authority@1.2.0/node_modules/port-authority/dist/port-authority.esm.js","../src/api/utils/Deferred.ts"],"sourcesContent":["import { connect, createServer, createConnection } from 'net';\nimport { exec as exec$1 } from 'child_process';\n\nfunction wait(port, { timeout = 5000 } = {}) {\n\treturn new Promise((fulfil, reject) => {\n\t\tconst t = setTimeout(() => {\n\t\t\treject(new Error(`timed out waiting for connection`));\n\t\t}, timeout);\n\n\t\tget_connection(port, () => {\n\t\t\tclearTimeout(t);\n\t\t\tfulfil();\n\t\t});\n\t});\n}\n\nfunction get_connection(port, cb) {\n\tlet timeout;\n\n\tconst socket = connect(port, 'localhost', () => {\n\t\tcb();\n\t\tsocket.destroy();\n\t\tclearTimeout(timeout);\n\t});\n\n\tsocket.on('error', () => {\n\t\tclearTimeout(timeout);\n\t\tsetTimeout(() => {\n\t\t\tget_connection(port, cb);\n\t\t}, 10);\n\t});\n\n\ttimeout = setTimeout(() => {\n\t\tsocket.destroy();\n\t}, 5000);\n}\n\nconst host = 'localhost';\n\nlet promise;\n\n\nfunction weird() {\n\tif (!promise) {\n\t\tpromise = get_weird(9000);\n\t}\n\treturn promise;\n}\n\nfunction get_weird(port) {\n\treturn new Promise(fulfil => {\n\t\tconst server = createServer();\n\n\t\tserver.unref();\n\n\t\tserver.on('error', () => {\n\t\t\tfulfil(get_weird(port + 1));\n\t\t});\n\n\t\tserver.listen({ host, port }, () => {\n\t\t\tconst server2 = createServer();\n\n\t\t\tserver2.unref();\n\n\t\t\tserver2.on('error', () => {\n\t\t\t\tserver.close(() => {\n\t\t\t\t\tfulfil(false);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tserver2.listen({ host, port }, () => {\n        server2.close(() => {\n          server.close(() => {\n            fulfil(true);\n          });\n        });\n      });\n\t\t});\n\t});\n}\n\nfunction check(port) {\n\treturn weird().then(weird => {\n\t\tif (weird) {\n\t\t\treturn check_weird(port);\n\t\t}\n\n\t\treturn new Promise(fulfil => {\n\t\t\tconst server = createServer();\n\n\t\t\tserver.unref();\n\n\t\t\tserver.on('error', () => {\n\t\t\t\tfulfil(false);\n\t\t\t});\n\n\t\t\tserver.listen({ host, port }, () => {\n\t\t\t\tserver.close(() => {\n\t\t\t\t\tfulfil(true);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction check_weird(port) {\n\treturn new Promise(fulfil => {\n\t\tconst client = createConnection({ host, port }, () => {\n\t\t\t\tclient.end();\n\t\t\t\tfulfil(false);\n\t\t\t})\n\t\t\t.on('error', () => {\n\t\t\t\tfulfil(true);\n\t\t\t});\n\t});\n}\n\nfunction until(port, { timeout = 5000 } = {}) {\n\treturn new Promise((fulfil, reject) => {\n\t\tconst t = setTimeout(() => {\n\t\t\treject(new Error(`timed out waiting for connection`));\n\t\t}, timeout);\n\n\t\twhen_port_available(port, () => {\n\t\t\tclearTimeout(t);\n\t\t\tfulfil();\n\t\t});\n\t});\n}\n\nfunction when_port_available(port, cb) {\n    const doCheck = async () => {\n        const isFree = await check(port);\n        if (isFree) return cb();\n        setTimeout(doCheck, 100);\n    };\n\n    doCheck();\n}\n\nfunction exec(cmd) {\n\treturn new Promise((fulfil, reject) => {\n\t\texec$1(cmd, (error, stdout, stderr) => {\n\t\t\tif (error) return reject(error);\n\t\t\tfulfil({ stdout, stderr });\n\t\t});\n\t});\n}\n\nasync function blame(port) {\n\ttry {\n\t\tconst { stdout } = await exec(`lsof -i :${port} -sTCP:LISTEN -Fp`);\n\n\t\tif (!stdout) return null;\n\t\tconst pid = parseInt(stdout.slice(1), 10);\n\t\tif (isNaN(pid)) throw new Error(`Invalid stdout ${stdout}`);\n\n\t\treturn pid;\n\t} catch (error) {\n\t\treturn null;\n\t}\n}\n\nfunction find(port) {\n\treturn weird().then(weird => {\n\t\tif (weird) {\n\t\t\treturn new Promise(fulfil => {\n\t\t\t\tget_port_weird(port, fulfil);\n\t\t\t});\n\t\t}\n\t\treturn new Promise(fulfil => {\n\t\t\tget_port(port, fulfil);\n\t\t});\n\t});\n}\n\nfunction get_port(port, cb) {\n\tconst server = createServer();\n\n\tserver.unref();\n\n\tserver.on('error', () => {\n\t\tget_port(port + 1, cb);\n\t});\n\n\tserver.listen({ host, port }, () => {\n\t\tserver.close(() => {\n\t\t\tcb(port);\n\t\t});\n\t});\n}\n\nfunction get_port_weird(port, cb) {\n\tconst client = createConnection({ host, port }, () => {\n\t\t\tclient.end();\n\t\t\tget_port(port + 1, cb);\n\t\t})\n\t\t.on('error', () => {\n\t\t\tcb(port);\n\t\t});\n}\n\nasync function kill(port) {\n\tconst pid = await blame(port);\n\tif (!pid) return false;\n\n\tawait exec(`kill ${pid}`);\n\treturn true;\n}\n\nconst waitUntilBusy = wait;\nconst waitUntilFree = until;\n\nexport { blame, check, find, kill, until, wait, waitUntilBusy, waitUntilFree };\n","export default class Deferred {\n\tpromise: Promise<any>;\n\tfulfil: (value?: any) => void;\n\treject: (error: Error) => void;\n\n\tconstructor() {\n\t\tthis.promise = new Promise((fulfil, reject) => {\n\t\t\tthis.fulfil = fulfil;\n\t\t\tthis.reject = reject;\n\t\t});\n\t}\n}"],"names":["connect","createServer","createConnection"],"mappings":"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"}